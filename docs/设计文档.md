ğŸ“˜ Telegram Bot æƒé™ä¸äº¤äº’ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼ˆç»™ Trae å®æ–½ç”¨ï¼‰
ğŸ§© 1. æƒé™ç»“æ„è®¾è®¡
æƒé™ç­‰çº§ï¼ˆç”±ä½åˆ°é«˜ï¼‰

user

adminï¼ˆæ‹¥æœ‰æ‰€æœ‰ user åŠŸèƒ½ï¼‰

ownerï¼ˆå”¯ä¸€ï¼Œæ‹¥æœ‰å…¨éƒ¨æƒé™ + ç®¡ç†é¢æ¿ + é…ç½®æ€»å¼€å…³ï¼‰

æƒé™æ ¡éªŒæ–¹å¼

åœ¨ middlewares/auth.py ä¸­æå‰å°†ç”¨æˆ·ä¿¡æ¯æ³¨å…¥ contextï¼ŒåŒ…æ‹¬ï¼š

user.role

user.id

åœ¨ handler ä¸­ä½¿ç”¨è£…é¥°å™¨æˆ–è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æƒé™ã€‚

ğŸ–¼ï¸ 2. äº¤äº’é£æ ¼ï¼ˆç¼–è¾‘æ¶ˆæ¯ + å›¾ç‰‡ + caption + åŠ¨æ€æŒ‰é’®ï¼‰

æ‰€æœ‰ç”¨æˆ·äº¤äº’åŸºäº å•æ¡æ¶ˆæ¯ç¼–è¾‘æ¨¡å¼ å®ç°ï¼Œä»¥ä¿æŒèŠå¤©çª—å£æ•´æ´ã€‚

å…³é”®ç‚¹

æ¯æ¬¡ç”¨æˆ·ç‚¹å‡»æŸä¸ªæŒ‰é’®æ—¶ï¼š

ä¸å‘é€æ–°çš„å›¾ç‰‡ï¼ˆé¿å…åˆ·å±ï¼‰

ä»… edit_caption + edit_reply_markup

ä»…åœ¨é¦–æ¬¡è¿›å…¥æˆ–åˆ‡æ¢æ¨¡å—æ—¶æ›´æ–°å›¾ç‰‡ã€‚

å›¾ç‰‡ç»Ÿä¸€æ”¾åœ¨ assets/ï¼Œå‘½åå¦‚ï¼š

assets/ui/start_owner.jpg
assets/ui/start_admin.jpg
assets/ui/start_user.jpg
assets/ui/panel_general.jpg

æŠ½è±¡äº¤äº’æ§åˆ¶å™¨

æ”¾åœ¨ï¼šbot/handlers/menu.py

ç»Ÿä¸€æ–¹æ³•ï¼š

async def render_view(message, image_path, caption, keyboard):
    await message.edit_media(
        media=InputMediaPhoto(open(image_path, "rb")),
        reply_markup=keyboard
    )

ğŸ§­ 3. å…¥å£ /start è¡Œä¸ºè®¾è®¡
ä¸åŒæƒé™å¯¹åº”ä¸åŒé¦–é¡µç•Œé¢
user

æ–‡å­—æè¿°ï¼šåŠŸèƒ½å…¥å£ã€ä¸ªäººä¿¡æ¯

æŒ‰é’®ï¼š

ä¸ªäººä¿¡æ¯

æ¶ˆæ¯å¯¼å‡º

æ”¯æŒ

admin

åŒ…æ‹¬ user å…¨éƒ¨æŒ‰é’® + ä»¥ä¸‹ï¼š

ç¾¤ç»„ç®¡ç†

æ¶ˆæ¯å®¡è®¡

ç»Ÿè®¡æ•°æ®

owner

åŒ…æ‹¬ admin å…¨éƒ¨ + ç®¡ç†é¢æ¿

åŠŸèƒ½å¯ç”¨/ç¦ç”¨

æœºå™¨äººå¯ç”¨å¼€å…³

åŠŸèƒ½å­å¼€å…³

ç®¡ç†å‘˜åˆ—è¡¨ç¼–è¾‘

ğŸ› ï¸ 4. ç®¡ç†é¢æ¿ï¼ˆä»… ownerï¼‰

æ‰€æœ‰å¼€å…³éœ€è¦åŒæ­¥åˆ°æ•°æ®åº“ config è¡¨ã€‚

ğŸ”§ æ€»æ§åˆ¶ç»“æ„
å¼€å…³ç±»å‹	å­—æ®µç¤ºä¾‹	æè¿°
Bot æ€»å¼€å…³	bot_enabled	æ˜¯å¦å…è®¸æœºå™¨äººç»§ç»­æœåŠ¡
åŠŸèƒ½æ€»å¼€å…³	features_enabled	æ˜¯å¦å¯ç”¨æ‰€æœ‰åŠŸèƒ½
å­åŠŸèƒ½å¼€å…³	feature_xxx_enabled	é’ˆå¯¹æ¯ä¸€é¡¹åŠŸèƒ½
ğŸ“Œ é¢æ¿å±‚çº§è®¾è®¡

ä¸€çº§èœå•ï¼ˆowner å¯è§ï¼‰ï¼š

æœºå™¨äººæ€»å¼€å…³
åŠŸèƒ½å¼€å…³ï¼ˆè¿›å…¥å­èœå•ï¼‰
ç®¡ç†å‘˜ç®¡ç†
ç³»ç»Ÿç»Ÿè®¡
è¿”å›


åŠŸèƒ½å¼€å…³å­èœå•ï¼š

å¯ç”¨/ç¦ç”¨ å…¨éƒ¨åŠŸèƒ½
å¯ç”¨/ç¦ç”¨ åŠŸèƒ½ A
å¯ç”¨/ç¦ç”¨ åŠŸèƒ½ B
...
è¿”å›


ç®¡ç†å‘˜ç¼–è¾‘èœå•ï¼š

æ·»åŠ ç®¡ç†å‘˜
åˆ é™¤ç®¡ç†å‘˜
æŸ¥çœ‹ç®¡ç†å‘˜åˆ—è¡¨
è¿”å›


æ¯ä¸ªåŠ¨ä½œéƒ½é€šè¿‡ edit_caption æ›´æ–°ç•Œé¢ã€‚

ğŸ§± 5. æ•°æ®åº“è®¾è®¡ï¼ˆç®€åŒ–ç‰ˆï¼‰
è¡¨ï¼šuser
id: int
telegram_id: int
role: Enum("owner", "admin", "user")
created_at

è¡¨ï¼šconfig
id: int
key: str
value: str/json/bool
updated_at


ä¾‹å¦‚ï¼š

("bot_enabled", true)
("features_enabled", false)
("feature_export_users", true)

ğŸ§  6. ä¸­é—´ä»¶ï¼ˆauthï¼‰

è‡ªåŠ¨åŠ è½½ç”¨æˆ·èº«ä»½ï¼Œç»‘å®š event.user_roleï¼š

event.user_role = db_user.role


åœ¨ handler ä¸­åˆ¤æ–­å³å¯ï¼š

@router.callback_query(RoleFilter("admin", "owner"))

ğŸ›ï¸ 7. é”®ç›˜ç»“æ„ç»„ç»‡

æ”¾åœ¨ï¼šbot/keyboards/inline/

start_user.py

start_admin.py

start_owner.py

panel_main.py

panel_features.py

panel_admins.py

å»ºè®®æ¯ä¸ªé”®ç›˜ç”¨ç±»æ–¹æ³•æä¾›çŠ¶æ€ï¼š

class OwnerPanelKeyboard:
    @staticmethod
    def main():
        return InlineKeyboardMarkup(...)

ğŸ“š 8. Handlers è·¯ç”±åˆ’åˆ†å»ºè®®
handlers/
    start.py
    menu.py   â† æ‰€æœ‰ç•Œé¢æ¸²æŸ“é€»è¾‘
    owner/
        panel.py
        panel_features.py
        panel_admins.py


æ¯ä¸ª panel æ–‡ä»¶ä¸è¦åšæ•°æ®åº“ç›´æ¥æ“ä½œï¼Œç»Ÿä¸€ä½¿ç”¨ï¼š

services/
    config_service.py
    users.py

ğŸ”Œ 9. æœåŠ¡å±‚ï¼ˆservicesï¼‰
config_service
get(key)
set(key, value)
toggle(key)
list_features()

users
add_admin()
remove_admin()
is_admin()
list_admins()

ğŸ“¡ 10. Trae å®æ–½ä»£ç éœ€æ³¨æ„

UI æ›´æ–°ç»Ÿä¸€è°ƒç”¨ render_view()

æ¯ä¸€ä¸ª callback_data ç”¨ç»„å‰ç¼€ï¼Œä¾‹å¦‚ï¼š

panel:main
panel:features
features:toggle:export_users
admins:add
admins:remove


ä¸è¦è®© handler æ–‡ä»¶å†™é€»è¾‘ï¼Œæ‰€æœ‰é€»è¾‘äº¤ç»™ service