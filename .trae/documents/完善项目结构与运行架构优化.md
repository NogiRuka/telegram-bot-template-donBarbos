## 目标
- 移除 Redis 与 Webhook 相关代码与配置，清理未使用组件与依赖，保留轮询模式与内存 FSM。
- 精简入口与中间件，降低复杂度，确保现有功能不受影响。

## 精简范围与原则
- 不改变对外行为与命令集合；仅删除无用路径与配置。
- 删除后确保能在 Windows 下通过 `python -m bot` 正常启动与运行。

## 删除与调整项（按文件）
- 入口与加载器
  - `bot/__main__.py`：删除 Webhook 相关方法与分支（`setup_webhook()`、`dp.start_webhook(...)` 等），仅保留 `dp.start_polling(...)`；移除与 Webhook 绑定的 Prometheus 初始化。
  - `bot/core/loader.py`：移除 `aiohttp` `web.Application()` 与任何 Webhook 绑定对象；保留 `Bot` 与 `Dispatcher(storage=MemoryStorage())`。
- 中间件
  - `bot/middlewares/prometheus.py`（如仅为 Webhook 提供请求指标）：移除文件与其在 `bot/middlewares/__init__.py` 中的注册。
  - 保留 `LoggingMiddleware`、`DatabaseMiddleware`、`ThrottlingMiddleware` 等实际使用的中间件。
- 配置
  - `bot/core/config.py`：删除 `WebhookSettings` 类与相关字段（如 `WEBHOOK_URL/WEBHOOK_PATH/WEBHOOK_SECRET` 等）；删除 `CacheSettings` 中 Redis 相关字段与拼接逻辑；清理 `Settings` 聚合中的 Webhook/Redis 字段。
  - `.env.example`：移除 Webhook 与 Redis 变量示例，仅保留 `BOT_TOKEN`、数据库与必要选项。
- 依赖
  - `pyproject.toml`：移除仅用于 Redis/Webhook/Prometheus 的依赖（如 `redis`、`prometheus-client`，以及若未被其他模块使用的 `aiohttp` 显式引用）；确保 aiogram 所需的核心依赖仍在。
- 路由聚合
  - `bot/handlers/__init__.py`：删除对 Prometheus 或 Webhook 专用路由的接入（如存在）。其余保持原状。

## 保留与优化
- 保留轮询模式与内存 FSM：无需外部存储，减少复杂性与运维成本。
- 日志：在 `bot/__main__.py` 初始化前确保 `logs` 目录创建，Loguru 输出保留；Sentry 如未使用可置为默认关闭并保留可选初始化。
- 错误处理：在启动/关闭钩子处补充 `try/except`，给出明确错误输出；数据库会话释放确保无泄漏。
- 编码规范：对涉及改动的函数补充函数级注释（功能说明、输入参数、返回值），保持 snake_case；明确异步/同步用法；注释 Telegram API 限制（消息 ≤ 4096、频率与 FloodWait）。

## 提交与验证
1) 删除/精简上述文件中的 Redis/Webhook/Prometheus 相关代码与配置。
2) 更新依赖与 `.env.example`，保证最小依赖集合可运行。
3) 本地通过 `python -m bot` 验证：所有命令与处理器工作正常；数据库连接正常；日志输出到 `logs/telegram_bot.log`。
4) 使用规范化 commit（Add/Remove/Refactor/Update）逐步提交；每次提交后在 Windows 环境重新运行验证。

确认后将按上述清单顺序进行最小侵入式清理与重构。